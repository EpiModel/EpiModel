<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with Model Parameters in EpiModel • EpiModel</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with Model Parameters in EpiModel">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/attributes-and-summary-statistics.html">Working with Custom Attributes and Summary Statistics in EpiModel</a></li>
    <li><a class="dropdown-item" href="../articles/Intro.html">EpiModel: Mathematical Modeling of Infectious Disease Dynamics</a></li>
    <li><a class="dropdown-item" href="../articles/model-parameters.html">Working with Model Parameters in EpiModel</a></li>
    <li><a class="dropdown-item" href="../articles/network-objects.html">Working with Network Objects in EpiModel</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EpiModel/EpiModel/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with Model Parameters in EpiModel</h1>
                        <h4 data-toc-skip class="author">EpiModel
v2.5.0</h4>
            
            <h4 data-toc-skip class="date">2024-09-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EpiModel/EpiModel/blob/main/vignettes/model-parameters.Rmd" class="external-link"><code>vignettes/model-parameters.Rmd</code></a></small>
      <div class="d-none name"><code>model-parameters.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In a model, <em>parameters</em> are the input variables used to
define aspects of the system behavior. In the basic built-in SIS
(Susceptible-Infected-Susceptible) model, these parameters could be the
<strong>act rate</strong>, the <strong>infection probability</strong>
and the <strong>recovery rate</strong>. In simple models, each of these
parameters are single fixed values that do not change over the course of
a simulation. In more complex models, we may want more flexibility in
model parameterization.</p>
<p>Therefore, in this vignette, we demonstrate how to implement:</p>
<ul>
<li>Scenarios: sets of parameters to be changed for a simulation, either
at the start or at a specific timestep.</li>
<li>Random parameters: distributions of possible values rather than a
single fixed value.</li>
<li>Time-varying parameters and control settings: The scenarios
functionality provides the most straightforward way to implement
time-varying parameters, but more direct functionality is demonstrated
here for advanced users seeking to implement time-varying parameters or
control settings.</li>
</ul>
</div>
<div class="section level2">
<h2 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h2>
<p>Scenarios can be defined as a single set of parameters to be used for
a particular model run. For this example we will use a simple SIS model
to demonstrate how scenarios work. First, we set up the model as we
would normally.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/network_initialize.html">network_initialize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netest.html">netest</a></span><span class="op">(</span><span class="va">nw</span>,</span>
<span>  formation <span class="op">=</span> <span class="op">~</span><span class="va">edges</span>, target.stats <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  coef.diss <span class="op">=</span> <span class="fu"><a href="../reference/dissolution_coefs.html">dissolution_coefs</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting maximum pseudolikelihood estimation (MPLE):</span></span>
<span><span class="co">#&gt; Obtaining the responsible dyads.</span></span>
<span><span class="co">#&gt; Evaluating the predictor and response matrix.</span></span>
<span><span class="co">#&gt; Maximizing the pseudolikelihood.</span></span>
<span><span class="co">#&gt; Finished MPLE.</span></span>
<span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span>inf.prob <span class="op">=</span> <span class="fl">0.9</span>, rec.rate <span class="op">=</span> <span class="fl">0.01</span>, act.rate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.net.html">init.net</a></span><span class="op">(</span>i.num <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"SIS"</span>, nsims <span class="op">=</span> <span class="fl">1</span>, nsteps <span class="op">=</span> <span class="fl">250</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="scenario-definitions">Scenario Definitions<a class="anchor" aria-label="anchor" href="#scenario-definitions"></a>
</h3>
<p>To define the scenarios, we will make use of the
<code><a href="../reference/create_scenario_list.html">EpiModel::create_scenario_list</a></code> function. It takes a
specially formatted <code>data.frame</code> as input and outputs a list
of scenarios usable by EpiModel.</p>
<p>We will use the <code><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tibble::tribble</a></code> function to create the
<code>data.frame</code> here. But any data frame construction methods
will work as long as the resulting <code>data.frame</code> is properly
formatted.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenarios.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">.scenario.id</span>, <span class="op">~</span><span class="va">.at</span>, <span class="op">~</span><span class="va">inf.prob</span>, <span class="op">~</span><span class="va">rec.rate</span>,</span>
<span>  <span class="st">"base"</span>, <span class="fl">0</span>, <span class="fl">0.9</span>, <span class="fl">0.01</span>,</span>
<span>  <span class="st">"initial_change"</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.01</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.04</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">100</span>, <span class="fl">0.9</span>, <span class="fl">0.01</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">200</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">scenarios.df</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">.scenario.id</th>
<th align="right">.at</th>
<th align="right">inf.prob</th>
<th align="right">rec.rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">base</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="left">initial_change</td>
<td align="right">0</td>
<td align="right">0.2</td>
<td align="right">0.01</td>
</tr>
<tr class="odd">
<td align="left">multiple_changes</td>
<td align="right">0</td>
<td align="right">0.1</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="left">multiple_changes</td>
<td align="right">100</td>
<td align="right">0.9</td>
<td align="right">0.01</td>
</tr>
<tr class="odd">
<td align="left">multiple_changes</td>
<td align="right">200</td>
<td align="right">0.1</td>
<td align="right">0.10</td>
</tr>
</tbody>
</table>
<p>A <code>data.frame</code> of scenarios must be formatted as follows.
First, there are two required columns: - <code>.scenario.id</code>: an
identifier for the scenario - <code>.at</code>: when should the changes
apply during the simulation</p>
<p>Any number of parameters columns. They must start with a letter and
contain only letters, numbers or <code>.</code>. Underscores
<code>_</code> are not accepted. If a cell is left empty
(<code>NA</code>), EpiModel will assume that you want to set the
parameter to <code>NA</code>. <code>NA</code> does not mean that the
value should remain unmodified.</p>
<p>In the <code>data.frame</code> above, three rows share the same
<code>.scenario.id</code>. This means that EpiModel will consider it a
single scenario were multiple events occur during the simulation.</p>
<p>To go from the <code>scenarios.df</code> to a list of usable
scenarios we run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenarios.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_scenario_list.html">create_scenario_list</a></span><span class="op">(</span><span class="va">scenarios.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">scenarios.list</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ base            :List of 2</span></span>
<span><span class="co">#&gt;   ..$ id                 : chr "base"</span></span>
<span><span class="co">#&gt;   ..$ .param.updater.list:List of 1</span></span>
<span><span class="co">#&gt;  $ initial_change  :List of 2</span></span>
<span><span class="co">#&gt;   ..$ id                 : chr "initial_change"</span></span>
<span><span class="co">#&gt;   ..$ .param.updater.list:List of 1</span></span>
<span><span class="co">#&gt;  $ multiple_changes:List of 2</span></span>
<span><span class="co">#&gt;   ..$ id                 : chr "multiple_changes"</span></span>
<span><span class="co">#&gt;   ..$ .param.updater.list:List of 3</span></span></code></pre></div>
<p>We now have a named list of scenarios. We will run all the scenarios,
combine there results and plot the number of susceptible and infected
over time to show what happened. To do so, we loop over all 3 scenarios
and use <code><a href="../reference/use_scenario.html">EpiModel::use_scenario</a></code> function to create a new
<code>sc.param</code> object to be used for the simulation
parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creation of a list that will hold the result of the simulations</span></span>
<span><span class="va">d_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">scenarios.list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scenarios.list</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">scenario</span> <span class="kw">in</span> <span class="va">scenarios.list</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># the id of the scenario is stored into `scenario$id`</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">sc.param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/use_scenario.html">use_scenario</a></span><span class="op">(</span><span class="va">param</span>, <span class="va">scenario</span><span class="op">)</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netsim.html">netsim</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">sc.param</span>, <span class="va">init</span>, <span class="va">control</span><span class="op">)</span></span>
<span>  <span class="co"># conversion to `data.frame` and storage of the scenario name in it</span></span>
<span>  <span class="va">d_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span>  <span class="va">d_sim</span><span class="op">[[</span><span class="st">"scenario"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">scenario</span><span class="op">$</span><span class="va">id</span></span>
<span>  <span class="va">d_list</span><span class="op">[[</span><span class="va">scenario</span><span class="op">$</span><span class="va">id</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d_sim</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "base"</span></span>
<span><span class="co">#&gt; [1] "initial_change"</span></span>
<span><span class="co">#&gt; [1] "multiple_changes"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A MESSAGE occured in module 'epimodel.internal' at step 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; At timestep = 100 the following parameters were modified:</span></span>
<span><span class="co">#&gt; 'inf.prob', 'rec.rate'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A MESSAGE occured in module 'epimodel.internal' at step 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; At timestep = 200 the following parameters were modified:</span></span>
<span><span class="co">#&gt; 'inf.prob', 'rec.rate'</span></span></code></pre></div>
<p>We see that for the “multiple_changes” scenarios, we received two
messages, at time step 100 and 200, telling us that some parameters were
changed during the simulation. The other scenarios were silent as the
changes occurred before the simulation began.</p>
<p>Now we can merge and plot the results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">time</span>, <span class="va">d_list</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">i.num</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">initial_change</span><span class="op">$</span><span class="va">time</span>, <span class="va">d_list</span><span class="op">$</span><span class="va">initial_change</span><span class="op">$</span><span class="va">i.num</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">multiple_changes</span><span class="op">$</span><span class="va">time</span>, <span class="va">d_list</span><span class="op">$</span><span class="va">multiple_changes</span><span class="op">$</span><span class="va">i.num</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.9</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-parameters_files/figure-html/plotting-1.png" width="768"></p>
<p>We can see that in the <code>initial_change</code> scenario, the
epidemic speed is slower than in the base “scenario” as we have reduced
the infection probability in the former.</p>
<p>The “multiple_changes” scenario shows different but expected results:
- at first the epidemic is very slow as the infection probability is low
and the recovery rate is high. - then at step 100, we apply the same
values as in the “base” scenario. Thus the epidemic trajectory
increases. - then at step 200, we reduce the infection probability and
increase the recovery rate, which results in a quick epidemic
extinction.</p>
<p>These scenarios are simplified to demonstrate the scenario system.
Our research paper implementing the idea of multiple time-varying
parameter changes was published in the <em>Journal of Infectious
Disease</em>. The code <a href="https://github.com/EpiModel/SexualDistancing" class="external-link">can be found
here</a>.</p>
</div>
<div class="section level3">
<h3 id="scenarios-with-parameter-vectors">Scenarios with Parameter Vectors<a class="anchor" aria-label="anchor" href="#scenarios-with-parameter-vectors"></a>
</h3>
<p>In full-scale modeling projects, we often have vectors of parameters.
For example, we may have a parameter, <code>hiv.test.rate</code>, which
is a vector of length 3 containing the weekly probabilities of HIV
screening for Black, Hispanic or White persons, respectively.</p>
<p>For such parameters we can still use the scenarios approach described
above. But in this case, we must define a column for each element of the
modified parameter and end it with a numerical value for the order in
which it lies in the vector: for example, <code>\_1</code>,
<code>\_2</code> and <code>\_3</code> for the B, H, and W rates. Here is
what that looks like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenarios.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">.scenario.id</span>, <span class="op">~</span><span class="va">.at</span>, <span class="op">~</span><span class="va">hiv.test.rate_1</span>, <span class="op">~</span><span class="va">hiv.test.rate_2</span>, <span class="op">~</span><span class="va">hiv.test.rate_3</span>,</span>
<span>  <span class="st">"base"</span>, <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>,</span>
<span>  <span class="st">"initial_change"</span>, <span class="fl">0</span>, <span class="fl">0.002</span>, <span class="fl">0.001</span>, <span class="fl">0.002</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">0</span>, <span class="fl">0.002</span>, <span class="fl">0.001</span>, <span class="fl">0.002</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">100</span>, <span class="fl">0.004</span>, <span class="fl">0.001</span>, <span class="fl">0.004</span>,</span>
<span>  <span class="st">"multiple_changes"</span>, <span class="fl">200</span>, <span class="fl">0.008</span>, <span class="fl">0.001</span>, <span class="fl">0.008</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">scenarios.df</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="24%">
<col width="5%">
<col width="23%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">.scenario.id</th>
<th align="right">.at</th>
<th align="right">hiv.test.rate_1</th>
<th align="right">hiv.test.rate_2</th>
<th align="right">hiv.test.rate_3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">base</td>
<td align="right">0</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">initial_change</td>
<td align="right">0</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">multiple_changes</td>
<td align="right">0</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">multiple_changes</td>
<td align="right">100</td>
<td align="right">0.004</td>
<td align="right">0.001</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">multiple_changes</td>
<td align="right">200</td>
<td align="right">0.008</td>
<td align="right">0.001</td>
<td align="right">0.008</td>
</tr>
</tbody>
</table>
<p>One thing to note is that you must pass in the values for each
sub-parameter in the <code>scenarios.df</code>. For example, even if the
value of the HIV screening rate for Hispanic persons (the second value
in the vector) is not changing across any scenarios, it is still
necessary to define it as <code>hiv.test.rate_2</code>.</p>
<p>When working with a lot of parameters, it is recommended to store the
<code>scenarios.df</code> as CSV or Excel file so your parameters can be
easily shared and edited.</p>
</div>
</div>
<div class="section level2">
<h2 id="parameters-input-via-table">Parameters Input Via Table<a class="anchor" aria-label="anchor" href="#parameters-input-via-table"></a>
</h2>
<p>Similar to the scenarios, the <code>param.net</code> function that
creates the <code>param</code> object for <code>netsim</code> allows for
inputting model parameters with a data.frame table. This allows a user
to pass in many parameters at once, or work with a spreadsheet to track
and update parameters before use in EpiModel.</p>
<p>The <code>data.frame</code> of parameters must be specifically
formatted such that the first 3 columns must be: 1. ‘param’: The name of
the parameter. If this is a non-scalar parameter (a vector of length
&gt; 1), end the parameter name with the position on the vector (e.g.,
<code>"p_1"</code>, <code>"p_2"</code>, …). 2. ‘value’: the value for
the parameter (or the value of the parameter in the Nth position if
non-scalar). 3. ‘type’: a character string containing either
<code>"numeric"</code>, <code>"logical"</code>, or
<code>"character"</code> to define the parameter object class.</p>
<p>In addition to these 3 columns, the <code>data.frame</code> can
contain any number of other columns, such as <code>details</code> or
<code>source</code> columns to document parameter meta-data. However,
these extra columns will not be used by EpiModel.</p>
<p>In this example, we are inputting the parameters into a
<code>data.frame</code> via <code>tribble</code>. In practice,
parameters may be stored in an Excel file or CSV file and imported into
a <code>data.frame</code> using the usual read functions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">param</span>, <span class="op">~</span><span class="va">value</span>, <span class="op">~</span><span class="va">type</span>,</span>
<span>  <span class="st">"hiv.test.rate_1"</span>,  <span class="st">"0.003"</span>,        <span class="st">"numeric"</span>,</span>
<span>  <span class="st">"hiv.test.rate_2"</span>,  <span class="st">"0.102"</span>,        <span class="st">"numeric"</span>,</span>
<span>  <span class="st">"hiv.test.rate_3"</span>,  <span class="st">"0.492"</span>,        <span class="st">"numeric"</span>,</span>
<span>  <span class="st">"prep.require.lnt"</span>, <span class="st">"TRUE"</span>,         <span class="st">"logical"</span>,</span>
<span>  <span class="st">"group_1"</span>,          <span class="st">"first"</span>,        <span class="st">"character"</span>,</span>
<span>  <span class="st">"group_2"</span>,          <span class="st">"second"</span>,       <span class="st">"character"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_params</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">param</th>
<th align="left">value</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">hiv.test.rate_1</td>
<td align="left">0.003</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">hiv.test.rate_2</td>
<td align="left">0.102</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">hiv.test.rate_3</td>
<td align="left">0.492</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">prep.require.lnt</td>
<td align="left">TRUE</td>
<td align="left">logical</td>
</tr>
<tr class="odd">
<td align="left">group_1</td>
<td align="left">first</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">group_2</td>
<td align="left">second</td>
<td align="left">character</td>
</tr>
</tbody>
</table>
<p>To use this table of parameters with <code>param.net</code>, pass in
the table of parameters via the <code>data.frame.params</code> argument
in <code>param.net</code>. Note that these parameters may also be
combined with named parameters outside of a table, for maximum
flexibility. In this example, we also pass in two extra parameters,
<code>other.param</code> and <code>act.rate</code>. Note that when the
<code>param</code> object is printed, all of the parameters are
processed as expected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span>data.frame.params <span class="op">=</span> <span class="va">df_params</span>,</span>
<span>                   other.param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, act.rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">param</span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; hiv.test.rate = 0.003 0.102 0.492</span></span>
<span><span class="co">#&gt; prep.require.lnt = TRUE</span></span>
<span><span class="co">#&gt; group = first second</span></span>
<span><span class="co">#&gt; act.rate = 1</span></span>
<span><span class="co">#&gt; other.param = 5 10</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="random-parameters">Random Parameters<a class="anchor" aria-label="anchor" href="#random-parameters"></a>
</h2>
<p>We have demonstrated how to work with fixed and time-varying
parameters above. One may also be interested in working with
distributions of parameters that may follow some parametric or
non-parametric form. For example, we may want to sample a range of
values for the probability of infection given contact for each
simulation of a model, instead of using a single value across all
simulations.</p>
<div class="section level3">
<h3 id="the-model">The Model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h3>
<p>EpiModel now includes functionality to input distributions of
parameters for network models. We will demonstrate this with a simple SI
model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/network_initialize.html">network_initialize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netest.html">netest</a></span><span class="op">(</span></span>
<span>  <span class="va">nw</span>, formation <span class="op">=</span> <span class="op">~</span><span class="va">edges</span>,</span>
<span>  target.stats <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  coef.diss <span class="op">=</span> <span class="fu"><a href="../reference/dissolution_coefs.html">dissolution_coefs</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting maximum pseudolikelihood estimation (MPLE):</span></span>
<span><span class="co">#&gt; Obtaining the responsible dyads.</span></span>
<span><span class="co">#&gt; Evaluating the predictor and response matrix.</span></span>
<span><span class="co">#&gt; Maximizing the pseudolikelihood.</span></span>
<span><span class="co">#&gt; Finished MPLE.</span></span>
<span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span></span>
<span>  inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  act.rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  dummy.param <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  dummy.strat.param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.net.html">init.net</a></span><span class="op">(</span>i.num <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"SI"</span>, nsims <span class="op">=</span> <span class="fl">1</span>, nsteps <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netsim.html">netsim</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">param</span>, <span class="va">init</span>, <span class="va">control</span><span class="op">)</span></span>
<span><span class="va">mod</span></span>
<span><span class="co">#&gt; EpiModel Simulation</span></span>
<span><span class="co">#&gt; =======================</span></span>
<span><span class="co">#&gt; Model class: netsim</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation Summary</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Model type: SI</span></span>
<span><span class="co">#&gt; No. simulations: 1</span></span>
<span><span class="co">#&gt; No. time steps: 5</span></span>
<span><span class="co">#&gt; No. NW groups: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; inf.prob = 0.3</span></span>
<span><span class="co">#&gt; act.rate = 0.5</span></span>
<span><span class="co">#&gt; dummy.param = 4</span></span>
<span><span class="co">#&gt; dummy.strat.param = 0 1</span></span>
<span><span class="co">#&gt; groups = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Output</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Variables: s.num i.num num si.flow</span></span>
<span><span class="co">#&gt; Networks: sim1</span></span>
<span><span class="co">#&gt; Transmissions: sim1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formation Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     25     27.4      9.6  1.806   1.329            NA         4.037</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Duration Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     10    9.898   -1.018  0.298  -0.341            NA         0.667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dissolution Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges    0.1    0.133   33.109  0.019   1.747            NA         0.042</span></span></code></pre></div>
<p>In the parameter list, we define four parameters:
<code>inf.prob</code>, which will remain a single fixed value, but also
<code>act.rate</code>, <code>dummy.param</code>, and
<code>dummy.strat.param</code>, which here are fixed but will be defined
below as random. The <code>dummy.strat.param</code> parameter has two
elements; this vector approach may be used, for example, to stratify a
parameter by subpopulation (e.g., as we did for the race-stratified HIV
screening rate example above). The last line prints a summary of the
model object. We can see the value of the parameters under the “Fixed
Parameters” section. Note the additional <code>groups</code> parameter
defined automatically by <code>EpiModel</code> as part of the “SI” model
definition.</p>
</div>
<div class="section level3">
<h3 id="adding-random-parameters">Adding Random Parameters<a class="anchor" aria-label="anchor" href="#adding-random-parameters"></a>
</h3>
<p>To allow our parameters to be drawn from a distribution of random
values, we use the <code>random.params</code> argument to
<code>param.net</code>. There are two ways of defining which parameters
are random, and the distribution of values for those random parameters
to draw randomly and how to draw them.</p>
<div class="section level4">
<h4 id="generator-functions">Generator Functions<a class="anchor" aria-label="anchor" href="#generator-functions"></a>
</h4>
<p>The first option is to define a generator function for each parameter
we want to declare as random.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my.randoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  act.rate <span class="op">=</span> <span class="fu"><a href="../reference/param_random.html">param_random</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dummy.param <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  dummy.strat.param <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.15</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span></span>
<span>  inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  random.params <span class="op">=</span> <span class="va">my.randoms</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">param</span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; inf.prob = 0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random Parameters</span></span>
<span><span class="co">#&gt; (Not drawn yet)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; act.rate = &lt;function&gt;</span></span>
<span><span class="co">#&gt; dummy.param = &lt;function&gt;</span></span>
<span><span class="co">#&gt; dummy.strat.param = &lt;function&gt;</span></span></code></pre></div>
<p>We kept the <code>inf.prob</code> parameter fixed at
<code>0.3</code>, and then defined a <code>list</code> object called
<code>my.randoms</code> containing 3 elements:</p>
<ul>
<li>
<code>act.rate</code> uses the <code>param_random</code> <a href="https://adv-r.hadley.nz/function-factories.html" class="external-link">function
factory</a> defined by EpiModel (see
<code><a href="../reference/param_random.html">?EpiModel::param_random</a></code>). In this case, each simulation
will sample one of the three defined values in the vector with equal
probability.</li>
<li>
<code>dummy.param</code> is a function with no argument that returns
a random value from a beta distribution.</li>
<li>
<code>dummy.strat.param</code> is a function with no argument that
returns 2 values sampled from normal distributions, each with different
means and standard deviations.</li>
</ul>
<p>Each element is named after the parameter it will fill and MUST BE a
function taking no argument and outputting a vector of the right size
for the parameter: size 1 for <code>act.rate</code> and
<code>dummy.param</code>; size 2 for <code>dummy.strat.param</code>.
Note that when we print out the parameter list before running the model,
it includes the random parameter definitions as functions, as their
sampled values are not yet realized.</p>
<p>The rest of the model is then run as before, although we increase the
simulation count to three to demonstrate the parameter
stochasticity.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"SI"</span>, nsims <span class="op">=</span> <span class="fl">3</span>, nsteps <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netsim.html">netsim</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">param</span>, <span class="va">init</span>, <span class="va">control</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span></span>
<span><span class="co">#&gt; EpiModel Simulation</span></span>
<span><span class="co">#&gt; =======================</span></span>
<span><span class="co">#&gt; Model class: netsim</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation Summary</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Model type: SI</span></span>
<span><span class="co">#&gt; No. simulations: 3</span></span>
<span><span class="co">#&gt; No. time steps: 5</span></span>
<span><span class="co">#&gt; No. NW groups: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; inf.prob = 0.3</span></span>
<span><span class="co">#&gt; groups = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; act.rate = 0.75 0.75 0.5</span></span>
<span><span class="co">#&gt; dummy.param = 0.1028706 0.3061986 0.6808219</span></span>
<span><span class="co">#&gt; dummy.strat.param = &lt;list&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Output</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Variables: s.num i.num num si.flow</span></span>
<span><span class="co">#&gt; Networks: sim1 ... sim3</span></span>
<span><span class="co">#&gt; Transmissions: sim1 ... sim3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formation Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     25   26.067    4.267  1.801   0.592         7.834         6.974</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Duration Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     10    9.232   -7.676  0.577   -1.33         2.452         2.236</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dissolution Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges    0.1    0.098   -2.157   0.02  -0.105         0.029         0.079</span></span></code></pre></div>
<p>After running 3 simulations we can see that the <code>inf.prob</code>
is still displayed under the “Fixed Parameters” section. The other three
parameters are displayed under the “Random Parameters” section:
<code>act.rate</code> and <code>dummy.param</code> now have 3 values
associated with them, one per simulation. <code>dummy.strat.param</code>
have <code>&lt;list&gt;</code> as its value because each simulation has
a vector of size 2.</p>
<p>To more easily inspect the parameter values, we can use the
<code>get_param_set</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all.params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_param_set.html">get_param_set</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="va">all.params</span></span>
<span><span class="co">#&gt;   sim inf.prob vital groups act.rate dummy.param dummy.strat.param_1</span></span>
<span><span class="co">#&gt; 1   1      0.3 FALSE      1     0.75   0.1028706          0.06053865</span></span>
<span><span class="co">#&gt; 2   2      0.3 FALSE      1     0.75   0.3061986          0.05340469</span></span>
<span><span class="co">#&gt; 3   3      0.3 FALSE      1     0.50   0.6808219          0.06476905</span></span>
<span><span class="co">#&gt;   dummy.strat.param_2</span></span>
<span><span class="co">#&gt; 1           0.2141265</span></span>
<span><span class="co">#&gt; 2           0.1372369</span></span>
<span><span class="co">#&gt; 3           0.1315418</span></span></code></pre></div>
<p>These parameters can then be merged with the epidemic data, for easy
analysis of the relationship between parameters and outputs:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">epi</span>, <span class="va">all.params</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(sim)`</span></span>
<span><span class="co">#&gt;    sim time s.num i.num num si.flow inf.prob vital groups act.rate dummy.param</span></span>
<span><span class="co">#&gt; 1    1    1    40    10  50      NA      0.3 FALSE      1     0.75   0.1028706</span></span>
<span><span class="co">#&gt; 2    1    2    37    13  50       3      0.3 FALSE      1     0.75   0.1028706</span></span>
<span><span class="co">#&gt; 3    1    3    36    14  50       1      0.3 FALSE      1     0.75   0.1028706</span></span>
<span><span class="co">#&gt; 4    1    4    36    14  50       0      0.3 FALSE      1     0.75   0.1028706</span></span>
<span><span class="co">#&gt; 5    1    5    32    18  50       4      0.3 FALSE      1     0.75   0.1028706</span></span>
<span><span class="co">#&gt; 6    2    1    40    10  50      NA      0.3 FALSE      1     0.75   0.3061986</span></span>
<span><span class="co">#&gt; 7    2    2    38    12  50       2      0.3 FALSE      1     0.75   0.3061986</span></span>
<span><span class="co">#&gt; 8    2    3    38    12  50       0      0.3 FALSE      1     0.75   0.3061986</span></span>
<span><span class="co">#&gt; 9    2    4    37    13  50       1      0.3 FALSE      1     0.75   0.3061986</span></span>
<span><span class="co">#&gt; 10   2    5    37    13  50       0      0.3 FALSE      1     0.75   0.3061986</span></span>
<span><span class="co">#&gt; 11   3    1    40    10  50      NA      0.3 FALSE      1     0.50   0.6808219</span></span>
<span><span class="co">#&gt; 12   3    2    38    12  50       2      0.3 FALSE      1     0.50   0.6808219</span></span>
<span><span class="co">#&gt; 13   3    3    36    14  50       2      0.3 FALSE      1     0.50   0.6808219</span></span>
<span><span class="co">#&gt; 14   3    4    35    15  50       1      0.3 FALSE      1     0.50   0.6808219</span></span>
<span><span class="co">#&gt; 15   3    5    34    16  50       1      0.3 FALSE      1     0.50   0.6808219</span></span>
<span><span class="co">#&gt;    dummy.strat.param_1 dummy.strat.param_2</span></span>
<span><span class="co">#&gt; 1           0.06053865           0.2141265</span></span>
<span><span class="co">#&gt; 2           0.06053865           0.2141265</span></span>
<span><span class="co">#&gt; 3           0.06053865           0.2141265</span></span>
<span><span class="co">#&gt; 4           0.06053865           0.2141265</span></span>
<span><span class="co">#&gt; 5           0.06053865           0.2141265</span></span>
<span><span class="co">#&gt; 6           0.05340469           0.1372369</span></span>
<span><span class="co">#&gt; 7           0.05340469           0.1372369</span></span>
<span><span class="co">#&gt; 8           0.05340469           0.1372369</span></span>
<span><span class="co">#&gt; 9           0.05340469           0.1372369</span></span>
<span><span class="co">#&gt; 10          0.05340469           0.1372369</span></span>
<span><span class="co">#&gt; 11          0.06476905           0.1315418</span></span>
<span><span class="co">#&gt; 12          0.06476905           0.1315418</span></span>
<span><span class="co">#&gt; 13          0.06476905           0.1315418</span></span>
<span><span class="co">#&gt; 14          0.06476905           0.1315418</span></span>
<span><span class="co">#&gt; 15          0.06476905           0.1315418</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parameter-sets">Parameter Sets<a class="anchor" aria-label="anchor" href="#parameter-sets"></a>
</h4>
<p>The drawback of generator function approach above is that it cannot
produce correlated parameter sets. For instance, we may want
<code>dummy.param</code> and <code>dummy.strat.param</code> to be
related to one another within a single simulation. We might also use an
external method for generating parameter sets, such as Latin hypercube
sampling of multiple parameters.</p>
<p>For this, we need to pre-define a <code>data.frame</code> of
parameter values. In this example, we have five parameter sets:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">related.param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  dummy.param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">related.param</span><span class="op">$</span><span class="va">dummy.strat.param_1</span> <span class="op">&lt;-</span> <span class="va">related.param</span><span class="op">$</span><span class="va">dummy.param</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">related.param</span><span class="op">$</span><span class="va">dummy.strat.param_2</span> <span class="op">&lt;-</span> <span class="va">related.param</span><span class="op">$</span><span class="va">dummy.param</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">related.param</span></span>
<span><span class="co">#&gt;   dummy.param dummy.strat.param_1 dummy.strat.param_2</span></span>
<span><span class="co">#&gt; 1   0.4617801          0.01272452          1.39670169</span></span>
<span><span class="co">#&gt; 2   0.1466187         -0.18052249         -0.06651093</span></span>
<span><span class="co">#&gt; 3   0.2793416          0.25988325         -0.13010820</span></span>
<span><span class="co">#&gt; 4   0.2432117         -0.57827919          0.49723583</span></span>
<span><span class="co">#&gt; 5   0.1581942          2.33576271          1.86195969</span></span></code></pre></div>
<p>We now have a <code>data.frame</code> with 5 rows and 3 columns. Each
row contains a set of parameters values that will be used together in a
single simulation of the model. This way we keep the relationship
between each value.</p>
<p>The first column of the <code>data.frame</code> is named
<code>dummy.param</code>, similar to the name of the parameter. For
<code>dummy.start.param</code> we need two columns as the parameter
contains two values. To achieve this, we name the two columns
<code>dummy.start.param_1</code> and <code>dummy.strat.param_2</code>.
The value after the underscore informs <code>EpiModel</code> how it
should combine these values into a vector (note that this uses the same
syntax as with stratified parameters within model scenarios described
above). This in turn means that the underscore symbol is not allowed in
proper parameter names.</p>
<p>Then we set up the rest of the parameters. <code>related.param</code>
is saved in the <code>my.randoms</code> list under the special reserved
name <code>param.random.set</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my.randoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  act.rate <span class="op">=</span> <span class="fu"><a href="../reference/param_random.html">param_random</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  param.random.set <span class="op">=</span> <span class="va">related.param</span></span>
<span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span></span>
<span>  inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  random.params <span class="op">=</span> <span class="va">my.randoms</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">param</span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; inf.prob = 0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random Parameters</span></span>
<span><span class="co">#&gt; (Not drawn yet)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; act.rate = &lt;function&gt;</span></span>
<span><span class="co">#&gt; param.random.set = &lt;data.frame&gt; ( dimensions: 5 3 )</span></span></code></pre></div>
<p>The <code>inf.prob</code> parameter remains fixed, the
<code>act.rate</code> parameter remains random with independent sample,
but now a set of the two remaining parameters is passed in as correlated
parameters with <code>param.random_set</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"SI"</span>, nsims <span class="op">=</span> <span class="fl">3</span>, nsteps <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netsim.html">netsim</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">param</span>, <span class="va">init</span>, <span class="va">control</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span></span>
<span><span class="co">#&gt; EpiModel Simulation</span></span>
<span><span class="co">#&gt; =======================</span></span>
<span><span class="co">#&gt; Model class: netsim</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation Summary</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Model type: SI</span></span>
<span><span class="co">#&gt; No. simulations: 3</span></span>
<span><span class="co">#&gt; No. time steps: 5</span></span>
<span><span class="co">#&gt; No. NW groups: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; inf.prob = 0.3</span></span>
<span><span class="co">#&gt; groups = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random Parameters</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; dummy.param = 0.4617801 0.1581942 0.2793416</span></span>
<span><span class="co">#&gt; dummy.strat.param = &lt;list&gt;</span></span>
<span><span class="co">#&gt; act.rate = 0.25 0.25 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Output</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Variables: s.num i.num num si.flow</span></span>
<span><span class="co">#&gt; Networks: sim1 ... sim3</span></span>
<span><span class="co">#&gt; Transmissions: sim1 ... sim3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formation Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     25   25.533    2.133  0.689   0.774         2.309         2.669</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Duration Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges     10   10.376    3.763  0.677   0.556         3.024         2.622</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dissolution Statistics</span></span>
<span><span class="co">#&gt; ----------------------- </span></span>
<span><span class="co">#&gt;       Target Sim Mean Pct Diff Sim SE Z Score SD(Sim Means) SD(Statistic)</span></span>
<span><span class="co">#&gt; edges    0.1    0.106    6.142  0.009   0.668         0.005         0.047</span></span></code></pre></div>
<p>The output is similar to what we saw with the generator functions
defined above. See that the correlated parameter sets are sampled from
together from the data frame of parameters.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">related.param</span></span>
<span><span class="co">#&gt;   dummy.param dummy.strat.param_1 dummy.strat.param_2</span></span>
<span><span class="co">#&gt; 1   0.4617801          0.01272452          1.39670169</span></span>
<span><span class="co">#&gt; 2   0.1466187         -0.18052249         -0.06651093</span></span>
<span><span class="co">#&gt; 3   0.2793416          0.25988325         -0.13010820</span></span>
<span><span class="co">#&gt; 4   0.2432117         -0.57827919          0.49723583</span></span>
<span><span class="co">#&gt; 5   0.1581942          2.33576271          1.86195969</span></span>
<span><span class="fu"><a href="../reference/get_param_set.html">get_param_set</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sim inf.prob vital groups dummy.param dummy.strat.param_1 dummy.strat.param_2</span></span>
<span><span class="co">#&gt; 1   1      0.3 FALSE      1   0.4617801          0.01272452           1.3967017</span></span>
<span><span class="co">#&gt; 2   2      0.3 FALSE      1   0.1581942          2.33576271           1.8619597</span></span>
<span><span class="co">#&gt; 3   3      0.3 FALSE      1   0.2793416          0.25988325          -0.1301082</span></span>
<span><span class="co">#&gt;   act.rate</span></span>
<span><span class="co">#&gt; 1     0.25</span></span>
<span><span class="co">#&gt; 2     0.25</span></span>
<span><span class="co">#&gt; 3     0.50</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="time-varying-parameters-and-control-settings-advanced">Time-Varying Parameters and Control Settings (Advanced)<a class="anchor" aria-label="anchor" href="#time-varying-parameters-and-control-settings-advanced"></a>
</h2>
<p>Within EpiModel, the <em>scenarios</em> described above uses an
updater module to implement parameter changes at a given time step. This
section describes how these mechanisms function and how to use them
directly if the scenarios approach above is not flexible enough, or if
you would also like to have time-varying control settings.</p>
<div class="section level3">
<h3 id="parameter-updaters">Parameter Updaters<a class="anchor" aria-label="anchor" href="#parameter-updaters"></a>
</h3>
<p>To define what parameters should change and when during the
simulation, we need to define updater lists. An updater is a
<code>list</code> with two named elements: <code>at</code>, the time
step when the change will take place, and <code>param</code> a named
list of parameters to update. For example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    act.rate <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $at</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param</span></span>
<span><span class="co">#&gt; $param$inf.prob</span></span>
<span><span class="co">#&gt; [1] 0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param$act.rate</span></span>
<span><span class="co">#&gt; [1] 0.5</span></span></code></pre></div>
<p>This defines an updater that will change the value of the
<code>inf.prob</code> parameter to <code>0.3</code> and the value to the
<code>act.rate</code> parameter to <code>0.5</code>. This change will
happen at time step 10. If we want, multiple parameter changes, then we
can write a list of updaters:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a `list.of.updaters`</span></span>
<span><span class="va">list.of.updaters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># this is one updater</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    at <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>      act.rate <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># this is another updater</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    at <span class="op">=</span> <span class="fl">125</span>,</span>
<span>    param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      inf.prob <span class="op">=</span> <span class="fl">0.01</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example, we define two <strong>updaters</strong>, one that
occurs at time step 100 and the other one at time step 125. As
demonstrated below, these values for <code>inf.prob</code> and
<code>act.rate</code> will change from the values of <code>0.1</code>
established by <code>param.net</code>at the beginning of the time
series.</p>
</div>
<div class="section level3">
<h3 id="incorporating-updaters">Incorporating Updaters<a class="anchor" aria-label="anchor" href="#incorporating-updaters"></a>
</h3>
<p>Below we set up a complete example with a closed population SI model
using the parameters and updaters defined above. Note that the parameter
updaters get passed into <code>param.net</code> with the special
<code>.param.updater.list</code> argument.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param.net.html">param.net</a></span><span class="op">(</span></span>
<span> inf.prob <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span> act.rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span> .param.updater.list <span class="op">=</span> <span class="va">list.of.updaters</span></span>
<span><span class="op">)</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.net.html">init.net</a></span><span class="op">(</span>i.num <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span></span>
<span> type <span class="op">=</span> <span class="st">"SI"</span>,</span>
<span> nsims <span class="op">=</span> <span class="fl">1</span>,</span>
<span> nsteps <span class="op">=</span> <span class="fl">200</span>,</span>
<span> verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we run the model with a simple network structure:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/network_initialize.html">network_initialize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netest.html">netest</a></span><span class="op">(</span></span>
<span>  <span class="va">nw</span>,</span>
<span>  formation <span class="op">=</span> <span class="op">~</span><span class="va">edges</span>,</span>
<span>  target.stats <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  coef.diss <span class="op">=</span> <span class="fu"><a href="../reference/dissolution_coefs.html">dissolution_coefs</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting maximum pseudolikelihood estimation (MPLE):</span></span>
<span><span class="co">#&gt; Obtaining the responsible dyads.</span></span>
<span><span class="co">#&gt; Evaluating the predictor and response matrix.</span></span>
<span><span class="co">#&gt; Maximizing the pseudolikelihood.</span></span>
<span><span class="co">#&gt; Finished MPLE.</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netsim.html">netsim</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">param</span>, <span class="va">init</span>, <span class="va">control</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A MESSAGE occured in module 'epimodel.internal' at step 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; At timestep = 100 the following parameters were modified:</span></span>
<span><span class="co">#&gt; 'inf.prob', 'act.rate'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A MESSAGE occured in module 'epimodel.internal' at step 125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; At timestep = 125 the following parameters were modified:</span></span>
<span><span class="co">#&gt; 'inf.prob'</span></span></code></pre></div>
<p>The model plot here demonstrates the inflection points in the
epidemic trajectory at the two parameter change points defined
above.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span>, mean.smooth <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">125</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-parameters_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="section level4">
<h4 id="verbosity">Verbosity<a class="anchor" aria-label="anchor" href="#verbosity"></a>
</h4>
<p>When creating a parameter updater, one can add an optional
<code>verbose</code> element to the <code>list</code>. If
<code>TRUE</code>, EpiModel will output a message` describing what
changes were performed and when they occurred.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    inf.prob <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    act.rate <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $at</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param</span></span>
<span><span class="co">#&gt; $param$inf.prob</span></span>
<span><span class="co">#&gt; [1] 0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param$act.rate</span></span>
<span><span class="co">#&gt; [1] 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $verbose</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="relative-parameter-changes">Relative Parameter Changes<a class="anchor" aria-label="anchor" href="#relative-parameter-changes"></a>
</h4>
<p>It may be useful to configure the changes with respect to the current
value instead of a fixed new value. This is possible as demonstrated
below for <code>inf.prob</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    inf.prob <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    act.rate <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $at</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param</span></span>
<span><span class="co">#&gt; $param$inf.prob</span></span>
<span><span class="co">#&gt; function(x) plogis(qlogis(x) + log(2))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param$act.rate</span></span>
<span><span class="co">#&gt; [1] 0.5</span></span></code></pre></div>
<p>This updater will set the value of <code>act.rate</code> to
<code>0.5</code> as before. But, for <code>inf.prob</code> we define a
function (not a function call). In this case, the will apply the
<code>function</code> to the current value of <code>act.rate</code>. If
we consider as in the previous example that <code>act.rate</code> is set
to <code>0.1</code> by <code>param.net</code>, then its new value will
be obtained by adding the log odds of 2 to the original value of
<code>inf.prob</code>: <code>plogis(qlogis(0.1) + log(2))</code>:
<code>0.1818182</code>. Whereas the previous value of
<code>inf.prob</code> was 0.10, the updated value will be 0.18.</p>
</div>
</div>
<div class="section level3">
<h3 id="time-varying-control-settings">Time-Varying Control Settings<a class="anchor" aria-label="anchor" href="#time-varying-control-settings"></a>
</h3>
<p>Similar to time-varying parameters, we can use time-varying controls.
These work in the same way. Each control updater is defined as a list of
lists.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a `list.of.updaters`</span></span>
<span><span class="va">list.of.updaters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># this is one updater</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    at <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      resimulate.network <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># this is another updater</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    at <span class="op">=</span> <span class="fl">125</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This example sets two control updaters, one that turns off network
resimulation at timestep 100 and another toggling of the model verbosity
at step 125.</p>
<p>The <code>list.of.updaters</code> then gets passed into
<code>control.net</code> through the special
<code>.control.updater.list</code> argument.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control.net.html">control.net</a></span><span class="op">(</span></span>
<span> type <span class="op">=</span> <span class="st">"SI"</span>,</span>
<span> nsims <span class="op">=</span> <span class="fl">1</span>,</span>
<span> nsteps <span class="op">=</span> <span class="fl">200</span>,</span>
<span> verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span> .control.updater.list <span class="op">=</span> <span class="va">list.of.updaters</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel Jenness, Steven M. Goodreau, Martina Morris, Adrien Le Guillou, Chad Klumb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
